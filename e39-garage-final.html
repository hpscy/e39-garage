<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E39 Garage - BMW E39 Projects & Tips</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        :root {
            --primary: #2196F3;
            --primary-light: #64B5F6;
            --accent: #FF6B35;
            --success: #4CAF50;
            --bg-dark: #1a1d24;
            --bg-card: #242831;
            --bg-hover: #2d323e;
            --text-primary: #e8edf2;
            --text-secondary: #9ca3af;
            --border: #353b48;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            line-height: 1.7;
        }

        /* Header */
        header {
            background: rgba(26, 29, 36, 0.95);
            backdrop-filter: blur(10px);
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        nav {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            cursor: pointer;
        }

        .logo span {
            color: var(--text-primary);
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
            align-items: center;
        }

        .nav-links a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s ease;
            cursor: pointer;
        }

        .nav-links a:hover {
            color: var(--primary);
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
            transition: gap 0.3s ease;
        }

        .back-button:hover {
            gap: 0.8rem;
        }

        /* Buttons */
        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-family: 'Nunito', sans-serif;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-light);
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #45a049;
        }

        .btn-secondary {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-secondary:hover {
            background: var(--primary);
            color: white;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }

        /* Hero */
        .hero {
            max-width: 1200px;
            margin: 0 auto;
            padding: 4rem 2rem 3rem;
            text-align: center;
        }

        .hero h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .hero h1 .highlight {
            color: var(--primary);
        }

        .hero p {
            font-size: 1.2rem;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto;
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 3rem 2rem;
        }

        .section-header {
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-title {
            font-family: 'Poppins', sans-serif;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .section-subtitle {
            color: var(--text-secondary);
            font-size: 1.05rem;
        }

        /* Stats */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin: 3rem 0;
        }

        .stat-card {
            background: var(--bg-card);
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
            border: 1px solid var(--border);
        }

        .stat-number {
            font-family: 'Poppins', sans-serif;
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary);
            display: block;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        /* Car Cards */
        .car-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2rem;
            margin-bottom: 4rem;
        }

        .car-card {
            background: var(--bg-card);
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid var(--border);
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
        }

        .car-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(33, 150, 243, 0.2);
            border-color: var(--primary);
        }

        .car-image {
            width: 100%;
            height: 250px;
            background: linear-gradient(135deg, #2d323e 0%, #242831 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            border-bottom: 3px solid var(--primary);
            position: relative;
            overflow: hidden;
        }

        .car-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .car-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: var(--primary);
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .car-content {
            padding: 2rem;
        }

        .car-title {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .car-subtitle {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-bottom: 1.5rem;
        }

        .car-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: rgba(33, 150, 243, 0.05);
            border-radius: 8px;
        }

        .car-stat-item {
            text-align: center;
        }

        .car-stat-value {
            font-family: 'Poppins', sans-serif;
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary);
            display: block;
        }

        .car-stat-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 0.2rem;
        }

        /* Entry Grid */
        .entry-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 2rem;
            margin-bottom: 4rem;
        }

        .entry-card {
            background: var(--bg-card);
            border-radius: 12px;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid var(--border);
            cursor: pointer;
        }

        .entry-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(33, 150, 243, 0.2);
            border-color: var(--primary);
        }

        .entry-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #2d323e 0%, #242831 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3.5rem;
            border-bottom: 2px solid var(--primary);
            position: relative;
            overflow: hidden;
        }

        .entry-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .entry-content {
            padding: 1.5rem;
        }

        .entry-tag {
            display: inline-block;
            background: rgba(33, 150, 243, 0.2);
            color: var(--primary);
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .entry-tag.maintenance {
            background: rgba(255, 107, 53, 0.2);
            color: var(--accent);
        }

        .entry-title {
            font-family: 'Poppins', sans-serif;
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 0.8rem;
            color: var(--text-primary);
        }

        .entry-description {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-bottom: 1rem;
            line-height: 1.6;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .entry-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .entry-author {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .author-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
        }

        /* Entry Detail Page */
        .entry-detail {
            max-width: 900px;
            margin: 0 auto;
        }

        .entry-hero {
            background: var(--bg-card);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border);
            margin-bottom: 2rem;
        }

        .entry-hero-image {
            width: 100%;
            height: 400px;
            background: linear-gradient(135deg, #2d323e 0%, #242831 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 6rem;
            border-bottom: 3px solid var(--primary);
        }

        .entry-hero-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .entry-hero-content {
            padding: 2rem;
        }

        .entry-meta {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .meta-badge {
            background: rgba(33, 150, 243, 0.2);
            color: var(--primary);
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .meta-badge.maintenance {
            background: rgba(255, 107, 53, 0.2);
            color: var(--accent);
        }

        .entry-detail-title {
            font-family: 'Poppins', sans-serif;
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 1rem;
        }

        .entry-detail-description {
            font-size: 1.1rem;
            color: var(--text-secondary);
            line-height: 1.8;
            margin-bottom: 1.5rem;
            white-space: pre-wrap;
        }

        .detail-section {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border);
        }

        .detail-section h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
        }

        .work-item {
            background: var(--bg-hover);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 3px solid var(--primary);
        }

        .work-item:last-child {
            margin-bottom: 0;
        }

        .work-item-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 0.8rem;
        }

        .work-item-title {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--text-primary);
        }

        .work-item-date {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .work-item-description {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 0.8rem;
        }

        .work-item-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }

        .detail-item {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 0.2rem;
        }

        .detail-value {
            font-weight: 600;
            color: var(--text-primary);
        }

        .parts-list {
            list-style: none;
            margin-top: 1rem;
        }

        .parts-list li {
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border);
            color: var(--text-secondary);
        }

        .parts-list li:last-child {
            border-bottom: none;
        }

        .parts-list li::before {
            content: "‚úì ";
            color: var(--primary);
            font-weight: 700;
            margin-right: 0.5rem;
        }

        /* Forms */
        .form-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .form-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 2rem;
            border: 1px solid var(--border);
            margin-bottom: 2rem;
        }

        .form-card h2 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 0.8rem;
            background: var(--bg-hover);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'Nunito', sans-serif;
            font-size: 0.95rem;
            transition: border-color 0.3s ease;
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-textarea {
            resize: vertical;
            min-height: 150px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
        }

        .parts-input-group {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .parts-input-group input {
            flex: 1;
        }

        .parts-list-display {
            margin-top: 0.5rem;
        }

        .parts-list-display .part-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            background: var(--bg-hover);
            border-radius: 4px;
            margin-bottom: 0.5rem;
        }

        .part-item button {
            background: transparent;
            border: none;
            color: var(--accent);
            cursor: pointer;
            font-size: 1.2rem;
        }

        /* Image Upload */
        .image-upload {
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .image-upload:hover {
            border-color: var(--primary);
            background: var(--bg-hover);
        }

        .image-upload input {
            display: none;
        }

        .image-preview {
            margin-top: 1rem;
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
        }

        .upload-icon {
            font-size: 3rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .upload-text {
            color: var(--text-secondary);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        /* Footer */
        footer {
            background: var(--bg-card);
            border-top: 1px solid var(--border);
            padding: 2rem;
            margin-top: 4rem;
            text-align: center;
            color: var(--text-secondary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }

            .nav-links {
                gap: 1rem;
            }

            .nav-links a:not(.btn) {
                display: none;
            }

            .entry-grid, .car-grid {
                grid-template-columns: 1fr;
            }

            .entry-hero-image {
                height: 250px;
                font-size: 4rem;
            }

            .entry-detail-title {
                font-size: 1.8rem;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <div id="root">
        <div style="display: flex; justify-content: center; align-items: center; height: 100vh; font-family: 'Nunito', sans-serif; color: #e8edf2;">
            <div style="text-align: center;">
                <div style="font-size: 3rem; margin-bottom: 1rem;">üîß</div>
                <div style="font-size: 1.5rem; font-weight: 700;">Loading E39 Garage...</div>
            </div>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ========================================
        // ü§ñ EMOJI AUTO-DETECTION
        // ========================================

        function detectEmojiFromDescription(description) {
            const text = description.toLowerCase();
            
            // Engine related
            if (text.includes('engine') || text.includes('motor') || text.includes('timing') || text.includes('vanos')) return 'üîß';
            if (text.includes('oil') || text.includes('fluid')) return 'üõ¢Ô∏è';
            
            // Suspension
            if (text.includes('suspension') || text.includes('control arm') || text.includes('bushing') || text.includes('shock')) return 'üõû';
            
            // Brakes
            if (text.includes('brake') || text.includes('rotor') || text.includes('caliper') || text.includes('pad')) return 'üõë';
            
            // Cooling
            if (text.includes('coolant') || text.includes('radiator') || text.includes('water pump') || text.includes('thermostat')) return 'üå°Ô∏è';
            
            // Electrical
            if (text.includes('electrical') || text.includes('battery') || text.includes('alternator') || text.includes('wire')) return 'üí°';
            if (text.includes('pixel') || text.includes('cluster') || text.includes('light')) return 'üí°';
            
            // Interior
            if (text.includes('interior') || text.includes('seat') || text.includes('trim') || text.includes('carpet')) return 'ü™ë';
            
            // Exterior/Paint
            if (text.includes('paint') || text.includes('bodywork') || text.includes('bumper') || text.includes('headlight')) return 'üé®';
            
            // Audio
            if (text.includes('audio') || text.includes('speaker') || text.includes('radio') || text.includes('head unit')) return 'üìª';
            
            // Transmission
            if (text.includes('transmission') || text.includes('clutch') || text.includes('gearbox')) return '‚öôÔ∏è';
            
            // Default
            return 'üîß';
        }

        // ========================================
        // üìù INITIAL DATA
        // ========================================

        const INITIAL_DATA = {
            stats: {
                carsOwned: 2,
                yearsExperience: 10,
                totalEntries: 0
            },
            cars: [
                {
                    id: 1,
                    model: "530i",
                    year: 2001,
                    title: "2001 530i",
                    subtitle: "Daily Driver",
                    ownedSince: 2015,
                    badge: "Daily",
                    image: null,
                    emoji: "üöó",
                    stats: {
                        owned: "2015",
                        mileage: "TBD",
                    }
                },
                {
                    id: 2,
                    model: "M5",
                    year: 2001,
                    title: "2001 M5",
                    subtitle: "Weekend Warrior",
                    ownedSince: 2023,
                    badge: "M Power",
                    image: null,
                    emoji: "üèÅ",
                    stats: {
                        owned: "2023",
                        mileage: "TBD",
                    }
                }
            ],
            entries: []
        };

        // ========================================
        // üé® COMPONENTS
        // ========================================

        function Header({ onNavigateHome, onNavigate }) {
            return (
                <header>
                    <nav>
                        <div className="logo" onClick={onNavigateHome}>
                            E39 <span>Garage</span>
                        </div>
                        <ul className="nav-links">
                            <li><a onClick={onNavigateHome}>Home</a></li>
                            <li>
                                <a className="btn btn-primary btn-small" onClick={() => onNavigate('add-entry')}>
                                    + Add Entry
                                </a>
                            </li>
                        </ul>
                    </nav>
                </header>
            );
        }

        function Hero() {
            return (
                <section className="hero">
                    <h1>My <span className="highlight">E39</span> Garage</h1>
                    <p>A collection of my E39 builds, projects, and lessons learned along the way</p>
                </section>
            );
        }

        function Stats({ data }) {
            const totalYears = new Date().getFullYear() - 2015;
            
            return (
                <div className="stats">
                    <div className="stat-card">
                        <span className="stat-number">{data.totalEntries}</span>
                        <span className="stat-label">Total Entries</span>
                    </div>
                    <div className="stat-card">
                        <span className="stat-number">{data.carsOwned}</span>
                        <span className="stat-label">E39s Owned</span>
                    </div>
                    <div className="stat-card">
                        <span className="stat-number">{totalYears}</span>
                        <span className="stat-label">Years Experience</span>
                    </div>
                </div>
            );
        }

        function CarCard({ car }) {
            const yearsOwned = new Date().getFullYear() - car.ownedSince;
            
            return (
                <div className="car-card">
                    <div className="car-image">
                        {car.image ? (
                            <img src={car.image} alt={car.title} />
                        ) : (
                            <span>{car.emoji}</span>
                        )}
                        <div className="car-badge">{car.badge}</div>
                    </div>
                    <div className="car-content">
                        <h3 className="car-title">{car.title}</h3>
                        <p className="car-subtitle">{car.subtitle}</p>
                        <div className="car-stats">
                            <div className="car-stat-item">
                                <span className="car-stat-value">{yearsOwned}</span>
                                <span className="car-stat-label">Years Owned</span>
                            </div>
                            <div className="car-stat-item">
                                <span className="car-stat-value">{car.stats.mileage}</span>
                                <span className="car-stat-label">Mileage</span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        function EntryCard({ entry, onClick }) {
            return (
                <div className="entry-card" onClick={() => onClick(entry.id)}>
                    <div className="entry-image">
                        {entry.image ? (
                            <img src={entry.image} alt={entry.title} />
                        ) : (
                            <span>{entry.emoji}</span>
                        )}
                    </div>
                    <div className="entry-content">
                        <span className={`entry-tag ${entry.type === 'maintenance' ? 'maintenance' : ''}`}>
                            {entry.type === 'project' ? 'Project' : 'Maintenance'}
                        </span>
                        <h3 className="entry-title">{entry.title}</h3>
                        <p className="entry-description">{entry.description}</p>
                        <div className="entry-footer">
                            <div className="entry-author">
                                <div className="author-avatar">ME</div>
                                <span>{entry.car}</span>
                            </div>
                            <span>{entry.date}</span>
                        </div>
                    </div>
                </div>
            );
        }

        function AddEntryForm({ onSave, onCancel, cars }) {
            const [formData, setFormData] = useState({
                car: cars[0].model,
                type: 'project',
                title: '',
                description: '',
                date: '',
                mileage: '',
                cost: '',
                parts: [],
                image: null,
                emoji: 'üîß'
            });

            const [currentPart, setCurrentPart] = useState('');
            const [imagePreview, setImagePreview] = useState(null);

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave(formData);
            };

            const handleChange = (field, value) => {
                setFormData(prev => {
                    const updated = { ...prev, [field]: value };
                    
                    // Auto-detect emoji when description changes
                    if (field === 'description') {
                        updated.emoji = detectEmojiFromDescription(value);
                    }
                    
                    return updated;
                });
            };

            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setImagePreview(reader.result);
                        setFormData(prev => ({ ...prev, image: reader.result }));
                    };
                    reader.readAsDataURL(file);
                }
            };

            const addPart = () => {
                if (currentPart.trim()) {
                    setFormData(prev => ({
                        ...prev,
                        parts: [...prev.parts, currentPart.trim()]
                    }));
                    setCurrentPart('');
                }
            };

            const removePart = (index) => {
                setFormData(prev => ({
                    ...prev,
                    parts: prev.parts.filter((_, i) => i !== index)
                }));
            };

            return (
                <div className="container">
                    <div className="form-container">
                        <a className="back-button" onClick={onCancel}>
                            ‚Üê Cancel
                        </a>

                        <form onSubmit={handleSubmit}>
                            <div className="form-card">
                                <h2>Add New Entry</h2>
                                
                                <div className="form-row">
                                    <div className="form-group">
                                        <label className="form-label">Car</label>
                                        <select 
                                            className="form-select"
                                            value={formData.car}
                                            onChange={(e) => handleChange('car', e.target.value)}
                                            required
                                        >
                                            {cars.map(car => (
                                                <option key={car.id} value={car.model}>{car.title}</option>
                                            ))}
                                        </select>
                                    </div>

                                    <div className="form-group">
                                        <label className="form-label">Type</label>
                                        <select 
                                            className="form-select"
                                            value={formData.type}
                                            onChange={(e) => handleChange('type', e.target.value)}
                                            required
                                        >
                                            <option value="project">Project</option>
                                            <option value="maintenance">Maintenance</option>
                                        </select>
                                    </div>
                                </div>

                                <div className="form-group">
                                    <label className="form-label">Title</label>
                                    <input 
                                        type="text"
                                        className="form-input"
                                        value={formData.title}
                                        onChange={(e) => handleChange('title', e.target.value)}
                                        placeholder="e.g., Complete Suspension Refresh"
                                        required
                                    />
                                </div>

                                <div className="form-group">
                                    <label className="form-label">Description</label>
                                    <textarea 
                                        className="form-textarea"
                                        value={formData.description}
                                        onChange={(e) => handleChange('description', e.target.value)}
                                        placeholder="Describe what you did, why you did it, what you learned..."
                                        required
                                    />
                                </div>

                                <div className="form-group">
                                    <label className="form-label">Upload Photo (Optional)</label>
                                    <label className="image-upload">
                                        <input 
                                            type="file"
                                            accept="image/*"
                                            onChange={handleImageUpload}
                                        />
                                        {imagePreview ? (
                                            <img src={imagePreview} alt="Preview" className="image-preview" />
                                        ) : (
                                            <>
                                                <div className="upload-icon">üì∑</div>
                                                <div className="upload-text">Click to upload a photo</div>
                                            </>
                                        )}
                                    </label>
                                </div>

                                <div className="form-row">
                                    <div className="form-group">
                                        <label className="form-label">Date</label>
                                        <input 
                                            type="text"
                                            className="form-input"
                                            value={formData.date}
                                            onChange={(e) => handleChange('date', e.target.value)}
                                            placeholder="e.g., March 2024"
                                            required
                                        />
                                    </div>

                                    <div className="form-group">
                                        <label className="form-label">Mileage (Optional)</label>
                                        <input 
                                            type="text"
                                            className="form-input"
                                            value={formData.mileage}
                                            onChange={(e) => handleChange('mileage', e.target.value)}
                                            placeholder="e.g., 185,200"
                                        />
                                    </div>

                                    <div className="form-group">
                                        <label className="form-label">Cost (Optional)</label>
                                        <input 
                                            type="text"
                                            className="form-input"
                                            value={formData.cost}
                                            onChange={(e) => handleChange('cost', e.target.value)}
                                            placeholder="e.g., $320"
                                        />
                                    </div>
                                </div>

                                <div className="form-group">
                                    <label className="form-label">Parts Used (Optional)</label>
                                    <div className="parts-input-group">
                                        <input 
                                            type="text"
                                            className="form-input"
                                            value={currentPart}
                                            onChange={(e) => setCurrentPart(e.target.value)}
                                            placeholder="Enter a part..."
                                            onKeyPress={(e) => e.key === 'Enter' && (e.preventDefault(), addPart())}
                                        />
                                        <button type="button" className="btn btn-primary" onClick={addPart}>
                                            Add
                                        </button>
                                    </div>
                                    <div className="parts-list-display">
                                        {formData.parts.map((part, index) => (
                                            <div key={index} className="part-item">
                                                <span>{part}</span>
                                                <button type="button" onClick={() => removePart(index)}>√ó</button>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                <div className="form-group">
                                    <label className="form-label">Auto-detected Emoji: {formData.emoji}</label>
                                    <p style={{fontSize: '0.85rem', color: 'var(--text-secondary)'}}>
                                        Emoji is automatically chosen based on your description
                                    </p>
                                </div>

                                <div className="form-actions">
                                    <button type="button" className="btn btn-secondary" onClick={onCancel}>
                                        Cancel
                                    </button>
                                    <button type="submit" className="btn btn-success">
                                        Save Entry
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        function EntryDetailPage({ entry, onBack }) {
            return (
                <div className="container">
                    <div className="entry-detail">
                        <a className="back-button" onClick={onBack}>
                            ‚Üê Back to Home
                        </a>

                        <div className="entry-hero">
                            <div className="entry-hero-image">
                                {entry.image ? (
                                    <img src={entry.image} alt={entry.title} />
                                ) : (
                                    <span>{entry.emoji}</span>
                                )}
                            </div>
                            <div className="entry-hero-content">
                                <div className="entry-meta">
                                    <span className={`meta-badge ${entry.type === 'maintenance' ? 'maintenance' : ''}`}>
                                        {entry.type === 'project' ? 'Project' : 'Maintenance'}
                                    </span>
                                    <span className="meta-badge">{entry.car}</span>
                                    <span className="meta-badge">{entry.date}</span>
                                </div>
                                <h1 className="entry-detail-title">{entry.title}</h1>
                                <p className="entry-detail-description">{entry.description}</p>
                                
                                {(entry.mileage || entry.cost) && (
                                    <div className="work-item-details">
                                        {entry.mileage && (
                                            <div className="detail-item">
                                                <span className="detail-label">Mileage</span>
                                                <span className="detail-value">{entry.mileage}</span>
                                            </div>
                                        )}
                                        {entry.cost && (
                                            <div className="detail-item">
                                                <span className="detail-label">Cost</span>
                                                <span className="detail-value">{entry.cost}</span>
                                            </div>
                                        )}
                                    </div>
                                )}

                                {entry.parts && entry.parts.length > 0 && (
                                    <div style={{marginTop: '1.5rem'}}>
                                        <h3 style={{fontSize: '1.2rem', marginBottom: '0.8rem'}}>Parts Used</h3>
                                        <ul className="parts-list">
                                            {entry.parts.map((part, idx) => (
                                                <li key={idx}>{part}</li>
                                            ))}
                                        </ul>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        function EmptyState({ icon, title, message }) {
            return (
                <div className="empty-state">
                    <div className="empty-state-icon">{icon}</div>
                    <h3>{title}</h3>
                    <p>{message}</p>
                </div>
            );
        }

        function App() {
            const [siteData, setSiteData] = useState(() => {
                const saved = localStorage.getItem('e39GarageData');
                return saved ? JSON.parse(saved) : INITIAL_DATA;
            });

            const [currentView, setCurrentView] = useState('home');
            const [selectedEntryId, setSelectedEntryId] = useState(null);

            useEffect(() => {
                localStorage.setItem('e39GarageData', JSON.stringify(siteData));
            }, [siteData]);

            const handleEntryClick = (entryId) => {
                setSelectedEntryId(entryId);
                setCurrentView('entry-detail');
                window.scrollTo(0, 0);
            };

            const handleBackToHome = () => {
                setCurrentView('home');
                setSelectedEntryId(null);
                window.scrollTo(0, 0);
            };

            const handleNavigate = (view) => {
                setCurrentView(view);
                window.scrollTo(0, 0);
            };

            const handleSaveEntry = (entryData) => {
                const newEntry = {
                    ...entryData,
                    id: Date.now()
                };

                setSiteData(prev => ({
                    ...prev,
                    entries: [...prev.entries, newEntry],
                    stats: {
                        ...prev.stats,
                        totalEntries: prev.stats.totalEntries + 1
                    }
                }));

                setCurrentView('home');
            };

            const selectedEntry = siteData.entries.find(e => e.id === selectedEntryId);

            return (
                <>
                    <Header onNavigateHome={handleBackToHome} onNavigate={handleNavigate} />
                    
                    {currentView === 'home' && (
                        <>
                            <Hero />
                            
                            <div className="container">
                                <Stats data={siteData.stats} />

                                <section id="cars">
                                    <div className="section-header">
                                        <div>
                                            <h2 className="section-title">My E39 Collection</h2>
                                            <p className="section-subtitle">The cars that started it all</p>
                                        </div>
                                    </div>
                                    
                                    <div className="car-grid">
                                        {siteData.cars.map(car => (
                                            <CarCard key={car.id} car={car} />
                                        ))}
                                    </div>
                                </section>

                                <section id="entries">
                                    <div className="section-header">
                                        <div>
                                            <h2 className="section-title">Work Log</h2>
                                            <p className="section-subtitle">Projects and maintenance entries</p>
                                        </div>
                                    </div>
                                    
                                    {siteData.entries.length > 0 ? (
                                        <div className="entry-grid">
                                            {siteData.entries.map(entry => (
                                                <EntryCard 
                                                    key={entry.id} 
                                                    entry={entry}
                                                    onClick={handleEntryClick}
                                                />
                                            ))}
                                        </div>
                                    ) : (
                                        <EmptyState 
                                            icon="üîß"
                                            title="No Entries Yet"
                                            message="Click '+ Add Entry' to start documenting your work!"
                                        />
                                    )}
                                </section>
                            </div>
                        </>
                    )}

                    {currentView === 'add-entry' && (
                        <AddEntryForm 
                            onSave={handleSaveEntry}
                            onCancel={handleBackToHome}
                            cars={siteData.cars}
                        />
                    )}

                    {currentView === 'entry-detail' && selectedEntry && (
                        <EntryDetailPage 
                            entry={selectedEntry}
                            onBack={handleBackToHome}
                        />
                    )}

                    <footer>
                        <p>E39 Garage - A hobbyist's collection of BMW E39 projects and tips</p>
                        <p style={{marginTop: '0.5rem', fontSize: '0.85rem'}}>
                            Built with ‚ù§Ô∏è for the E39 community ‚Ä¢ Data saved locally in your browser
                        </p>
                    </footer>
                </>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>